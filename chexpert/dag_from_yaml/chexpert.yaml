inputs: workspace/CheXPert-v1.0-small # TODO currently path in Airflow docker. Define this as relative to this dir, or absolute in host
base_docker: &BASE_DOCKER
  - type: docker
    image: mlcommons/chexpert-prep:0.1.0
    mounts:  &BASE_MOUNTS # TODO make this dynamic
      - path/to/workspace:/workspace
      - path/to/workspace/CheXPert-v1.0-small:/workspace/CheXPert-v1.0-small
      - path/to/workspace/data:/data
dags:
  - dag_id:  chexpert_pipeline
    dag_display_name: CheXPert Pipeline
    doc_md: "Example DAG for the CheXpert data preparation"
    tags:
      - All Subjects
    operators: 
      - <<: *BASE_DOCKER
        command: prepare --data_path /workspace/CheXPert-v1.0-small --labels_path /workspace/CheXPert-v1.0-small --parameters_file /workspace/parameters.yaml --output_path /data
        task_id: prepare
        task_display_name: Data Preparation
      - <<: *BASE_DOCKER
        command: sanity_check --data_path /data --parameters_file /workspace/parameters.yaml
        task_id: sanity_check
        task_display_name: Sanity Check
      - <<: *BASE_DOCKER
        command: statistics --data_path /data --parameters_file /workspace/parameters.yaml --output_path /data/statistics.yaml
        task_id: statistics
        task_display_name: Generate Statistics